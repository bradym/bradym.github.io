<!doctype html><html lang=en><head><title>Canonical redirect on IIS using PHP ::
Wandering Thoughts</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="According to the seo experts  of the world, it is good practice to force your website to always use the same domain. So, instead of having your site work at both www.example.com and example.com, choose one. Once you&amp;rsquo;ve chosen which form of your site to use, it&amp;rsquo;s time to setup 301 redirects to enforce that.
If you&amp;rsquo;re using Apache, it&amp;rsquo;s very easy, just add a quick mod_rewrite rule. You can remove the www  or force the use of www ."><meta name=keywords content="canonical,redirect,,iis,,php,,windows,shared,hosting"><meta name=robots content="noodp"><link rel=canonical href=http://www.bradym.net/php/canonical-redirect-iis.html><link rel=stylesheet href=http://www.bradym.net/assets/style.css><link rel=stylesheet href=http://www.bradym.net/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=http://www.bradym.net/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=http://www.bradym.net/img/favicon.png><link href=http://www.bradym.net/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=http://www.bradym.net/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=http://www.bradym.net/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=http://www.bradym.net/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=http://www.bradym.net/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=http://www.bradym.net/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><meta name=twitter:card content="summary"><meta name=twitter:title content="Canonical redirect on IIS using PHP"><meta name=twitter:description content="Using a Windows hosting account where you don't have the ability to modify IIS configurations? Here's one method for setting up a canonical redirect."><meta property="og:title" content="Canonical redirect on IIS using PHP"><meta property="og:description" content="Using a Windows hosting account where you don't have the ability to modify IIS configurations? Here's one method for setting up a canonical redirect."><meta property="og:type" content="article"><meta property="og:url" content="http://www.bradym.net/php/canonical-redirect-iis.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2008-09-03T00:00:00+00:00"><meta property="article:modified_time" content="2008-09-03T00:00:00+00:00"><meta property="og:site_name" content="Wandering Thoughts"></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>wandering thoughts</span>
<span class=logo__cursor></span></a>
<span class=header__right><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/tags/>Tags</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/tags/>Tags</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><div class=post><h1 class=post-title>Canonical redirect on IIS using PHP</h1><div class=post-meta><span class=post-date>2008-09-03</span></div><span class=post-tags><a href=http://www.bradym.net/tags/php/>#PHP</a>&nbsp;</span><div class=post-content><p>According to the <a href=http://www.mattcutts.com/blog/seo-advice-url-canonicalization/ target=_blank>seo experts</a> of the world, it is good practice to force your website to always use the same domain. So, instead of having your site work at both <code>www.example.com</code> and <code>example.com</code>, choose one. Once you&rsquo;ve chosen which form of your site to use, it&rsquo;s time to setup 301 redirects to enforce that.</p><p>If you&rsquo;re using Apache, it&rsquo;s very easy, just add a quick mod_rewrite rule. You can <a href=http://www.askapache.com/htaccess/mod_rewrite-tips-and-tricks.html#require-no-www-in-htaccess target=_blank>remove the www</a> or <a href=http://www.askapache.com/htaccess/mod_rewrite-tips-and-tricks.html#require-the-www-in-htaccess target=_blank>force the use of www
</a>. But since IIS doesn&rsquo;t use <code>.htaccess</code> files, it takes a little more effort.</p><h3 id=create-a-phpini-with-the-following-content-and-upload-it-to-your-site-root>Create a php.ini with the following content and upload it to your site root
<a href=#create-a-phpini-with-the-following-content-and-upload-it-to-your-site-root class=h-anchor aria-hidden=true>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#a6e22e>cgi.force_redirect</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>auto_prepend_file</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>C:\php_includes\canonical.php</span>
</span></span></code></pre></div><p>Keep in mind that you&rsquo;ll need to change the file path to reflect the
setup of your server.</p><h3 id=upload-canonicalphp-with-the-following-contents>Upload canonical.php with the following contents
<a href=#upload-canonicalphp-with-the-following-contents class=h-anchor aria-hidden=true>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Any directory index filenames should go in here with a leading /
</span></span></span><span style=display:flex><span><span style=color:#75715e>// This is removed when doing the redirect in order to maintain consistency,
</span></span></span><span style=display:flex><span><span style=color:#75715e>// without this, when visiting example.com you would be redirected to www.example.com/index.htm
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>$index_files <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>(<span style=color:#e6db74>&#39;/index.htm&#39;</span>,<span style=color:#e6db74>&#39;/index.html&#39;</span>,<span style=color:#e6db74>&#39;/index.php&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// The rewrite only kicks in if the host does not begin with www. and the code is not running
</span></span></span><span style=display:flex><span><span style=color:#75715e>// on localhost. When developing a site I setup dev.example.com on my dev machine and use
</span></span></span><span style=display:flex><span><span style=color:#75715e>// the same code as is on the live server, so I don&#39;t want to be redirected if I&#39;m
</span></span></span><span style=display:flex><span><span style=color:#75715e>// accessing the code locally.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>substr</span>($_SERVER[<span style=color:#e6db74>&#39;HTTP_HOST&#39;</span>],<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>4</span>) <span style=color:#f92672>!==</span> <span style=color:#e6db74>&#39;www.&#39;</span> <span style=color:#f92672>&amp;&amp;</span> $_SERVER[<span style=color:#e6db74>&#39;LOCAL_ADDR&#39;</span>] <span style=color:#f92672>!==</span> <span style=color:#e6db74>&#39;127.0.0.1&#39;</span>){
</span></span><span style=display:flex><span>    $url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;http://www.&#39;</span><span style=color:#f92672>.</span>$_SERVER[<span style=color:#e6db74>&#39;HTTP_HOST&#39;</span>]<span style=color:#f92672>.</span><span style=color:#a6e22e>str_replace</span>($index_files, <span style=color:#e6db74>&#39;&#39;</span>, $_SERVER[<span style=color:#e6db74>&#39;PATH_INFO&#39;</span>]);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>header</span> (<span style=color:#e6db74>&#39;HTTP/1.1 301 Moved Permanently&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#34;Location: </span><span style=color:#e6db74>$url</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>exit</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h3 id=notes>Notes:
<a href=#notes class=h-anchor aria-hidden=true>#</a></h3><ul><li>This method assumes that you don&rsquo;t have access to modify the server settings, ie: shared windows hosting. If you are able to modify how IIS is setup I&rsquo;m sure there&rsquo;s a better way to do this.</li><li>When PHP is run as a cgi, you can overwrite the php.ini settings by putting a php.ini in the site root. So if your windows host is not running php as a cgi, this won&rsquo;t work. I think that php is always run as a cgi on IIS, but I could be wrong.</li><li>This will only work if the site is using PHP - if you have a completely static site this won&rsquo;t help you. In order to use this with a static site, you&rsquo;d have to change the server settings to treat your html files as php files.</li></ul></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=http://www.bradym.net/php/http_build_query-and-arg_separator_output.html><span class=button__icon>←</span>
<span class=button__text>http_build_query() and arg_separator.output</span></a></span>
<span class="button next"><a href=http://www.bradym.net/windows/testing-in-multiple-versions-of-ie.html><span class=button__text>Testing in multiple versions of IE</span>
<span class=button__icon>→</span></a></span></div></div><div style=padding-top:15px><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//bradymnet.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div></div><footer class=footer><div class=footer__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>wandering thoughts</span>
<span class=logo__cursor></span></a><div class=copyright><span>© 2022<span></span></div></div></footer><script src=http://www.bradym.net/assets/main.js></script>
<script src=http://www.bradym.net/assets/prism.js></script></div></body></html>